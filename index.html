<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نقشه ایران</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --province-fill: #1e293b;
            --province-stroke: #475569;
            --province-hover: #3b82f6;
            --sidebar-width: 300px;
            --glass: rgba(30, 41, 59, 0.7);
        }
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-color);
            font-family: 'Tahoma', system-ui, sans-serif;
            color: white;
            overflow: hidden;
        }
        .main-wrapper {
            display: flex;
            width: 100vw;
            height: 100vh;
        }
        .sidebar {
            width: var(--sidebar-width);
            background: #111827;
            border-left: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            z-index: 10;
        }
        .sidebar-header {
            padding: 20px;
            background: #1e293b;
            text-align: center;
        }
        .sidebar-header h2 { margin: 0 0 15px 0; font-size: 1.1rem; color: #60a5fa; }
        #search-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            outline: none;
        }
        #search-input:focus { border-color: var(--province-hover); }
        .province-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0; margin: 0;
            list-style: none;
        }
        .province-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            transition: 0.2s;
        }
        .province-item:hover, .province-item.active { background: #2563eb; }
        #map-container {
            flex-grow: 1;
            position: relative;
            background: radial-gradient(circle, #1e293b 0%, #0f172a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 0;
        }
        svg {
            width: 95vw;
            max-width: 1150px;
            height: auto;
            max-height: 90vh;
            margin: 0 auto;
            display: block;
        }
        svg path {
            fill: var(--province-fill);
            stroke: var(--province-stroke);
            stroke-width: 0.6;
            transition: all 0.3s;
            cursor: pointer;
        }
        .highlight-province {
            fill: var(--province-hover) !important;
            stroke: #fff !important;
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.8));
        }
        #info-card {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            width: 280px;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #tooltip {
            position: fixed;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        @media (max-width: 768px) {
            .main-wrapper { flex-direction: column-reverse; }
            .sidebar { width: 100%; height: 40vh; }
            #info-card { 
                left: 10px; right: 10px; bottom: 10px; 
                width: auto; 
            }
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>نقشه ایران</h2>
                <input type="text" id="search-input" placeholder="جستجوی نام استان...">
            </div>
            <ul class="province-list" id="province-list"></ul>
        </aside>
        <main id="map-container">
            <div id="loader">در حال بارگذاری نقشه...</div>
            <div id="info-card"></div>
        </main>
    </div>
    <div id="tooltip"></div>

    <script>
        const provinceNames = {
            "alborz": "البرز",
            "ardabil": "اردبیل",
            "azerbaijan-east": "آذربایجان شرقی",
            "azerbaijan-west": "آذربایجان غربی",
            "bushehr": "بوشهر",
            "chaharmahal-bakhriari": "چهارمحال و بختیاری",
            "fars": "فارس",
            "gilan": "گیلان",
            "golestan": "گلستان",
            "hamadan": "همدان",
            "hormozgan": "هرمزگان",
            "ilam": "ایلام",
            "isfahan": "اصفهان",
            "kerman": "کرمان",
            "kermanshah": "کرمانشاه",
            "khorasan-north": "خراسان شمالی",
            "khorasan-razavi": "خراسان رضوی",
            "khorasan-south": "خراسان جنوبی",
            "khuzestan": "خوزستان",
            "kohgiluye-boyerahmad": "کهگیلویه و بویراحمد",
            "kurdistan": "کردستان",
            "lorestan": "لرستان",
            "markazi": "مرکزی",
            "mazandaran": "مازندران",
            "qazvin": "قزوین",
            "qom": "قم",
            "semnan": "سمنان",
            "sistan-baluchestan": "سیستان و بلوچستان",
            "tehran": "تهران",
            "yazd": "یزد",
            "zanjan": "زنجان"
        };

        const activeProvinces = new Set([
            "fars",
            "azerbaijan-west",
            "gilan",
            "hamadan",
            "isfahan",
            "khuzestan",
            "qazvin",
            "tehran",
            "yazd"
        ]);

        const mapUrl = 'https://raw.githubusercontent.com/nastoohir/iran-map-svg/master/iran.svg';
        const container = document.getElementById('map-container');
        const listContainer = document.getElementById('province-list');
        const tooltip = document.getElementById('tooltip');
        const infoCard = document.getElementById('info-card');
        const searchInput = document.getElementById('search-input');

        let currentSelectedId = null;

        function clearHighlight() {
            document.querySelectorAll('.highlight-province').forEach(p => p.classList.remove('highlight-province'));
        }

        function highlightProvince(provId) {
            clearHighlight();
            const path = document.querySelector(`path[id="${provId}"]`);
            if (path) path.classList.add('highlight-province');
        }

        function showInfo(provId) {
            const farsiName = provinceNames[provId] || provId;
            currentSelectedId = provId;

            const isActive = activeProvinces.has(provId);
            const targetUrl = isActive 
                ? `provinces/${provId}.html`
                : `provinces/coming-soon.html?id=${encodeURIComponent(provId)}`;
            const buttonText = isActive ? 'ورود به پنل استان' : 'مشاهده (در حال ساخت)';

            infoCard.style.display = 'block';
            infoCard.innerHTML = `
                <h3 style="margin:0; color:#60a5fa">${farsiName}</h3>
                <p style="font-size:0.9rem; margin:12px 0; line-height:1.5">
                    اینجا می‌توانید اطلاعات مربوط به استان ${farsiName} را مشاهده کنید.
                </p>
                <button class="card-btn" style="width:100%; padding:10px; background:#2563eb; border:none; border-radius:6px; color:white; cursor:pointer;" 
                    onclick="location.href='${targetUrl}'">
                    ${buttonText}
                </button>
            `;

            document.querySelectorAll('.province-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.provId === provId) {
                    item.classList.add('active');
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            });
        }

        async function init() {
            try {
                const response = await fetch(mapUrl);
                const svgText = await response.text();
                container.insertAdjacentHTML('afterbegin', svgText);
                document.getElementById('loader').remove();
                setupMap();
            } catch (e) {
                container.innerHTML = "خطا در بارگذاری نقشه";
            }
        }

        function setupMap() {
            const paths = document.querySelectorAll('svg path');

            const activeList = Array.from(activeProvinces)
                .map(id => ({ id, name: provinceNames[id] || id }))
                .filter(item => item.name)
                .sort((a, b) => a.name.localeCompare(b.name, 'fa-IR'));

            activeList.forEach(({ id, name }) => {
                const li = document.createElement('li');
                li.className = 'province-item';
                li.dataset.provId = id;
                li.innerHTML = `<span>${name}</span> <span>←</span>`;
                listContainer.appendChild(li);

                li.addEventListener('click', () => {
                    highlightProvince(id);
                    showInfo(id);
                });
            });

            paths.forEach(path => {
                const id = path.getAttribute('id');
                if (!id || !provinceNames[id]) {
                    if (id && (id.includes('sea') || id.includes('gulf') || id.includes('island'))) {
                        path.style.fill = '#0b1627';
                    }
                    path.style.pointerEvents = 'none';
                    return;
                }

                const name = provinceNames[id];

                path.addEventListener('click', () => {
                    highlightProvince(id);
                    showInfo(id);
                });

                path.addEventListener('mousemove', (e) => {
                    tooltip.style.display = 'block';
                    tooltip.textContent = name;
                    tooltip.style.left = (e.clientX + 15) + 'px';
                    tooltip.style.top = (e.clientY - 30) + 'px';
                });

                path.addEventListener('mouseleave', () => {
                    tooltip.style.display = 'none';
                });
            });

            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.trim();
                document.querySelectorAll('.province-item').forEach(item => {
                    const name = item.querySelector('span').textContent;
                    item.style.display = name.includes(term) ? 'flex' : 'none';
                });
            });
        }

        window.onload = init;
    </script>
</body>

</html>
