<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نقشه هوشمند ایران</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --province-fill: #1e293b;
            --province-stroke: #475569;
            --province-hover: #3b82f6;
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-color);
            font-family: 'Tahoma', sans-serif;
            color: white;
            overflow-x: hidden; /* جلوگیری از اسکرول عرضی در موبایل */
        }

        /* تغییر چیدمان برای موبایل */
        .main-wrapper { 
            display: flex; 
            flex-direction: row; /* حالت پیش‌فرض دسکتاپ */
            width: 100vw; 
            height: 100vh; 
        }

        @media (max-width: 768px) {
            .main-wrapper {
                flex-direction: column-reverse; /* نقشه بالا، لیست پایین */
                height: auto;
            }
            body, html { overflow: auto; } /* اجازه اسکرول در موبایل */
        }

        /* سایدبار */
        .sidebar {
            width: var(--sidebar-width);
            background: #111827;
            border-left: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: 40vh; /* محدود کردن ارتفاع لیست در موبایل */
            }
        }

        .sidebar-header {
            padding: 15px;
            background: #1e293b;
            text-align: center;
            position: sticky;
            top: 0;
        }

        .sidebar-header h2 { margin: 0; font-size: 1rem; color: #60a5fa; }

        .province-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .province-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            transition: 0.2s;
        }

        .province-item:active, .province-item.active {
            background: #2563eb;
        }

        /* نقشه */
        #map-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background: radial-gradient(circle, #1e293b 0%, #0f172a 100%);
            min-height: 50vh;
        }

        svg { 
            width: 100%; 
            height: auto; 
            max-height: 85vh;
            touch-action: manipulation; /* بهینه‌سازی لمس */
        }

        svg path {
            fill: var(--province-fill);
            stroke: var(--province-stroke);
            stroke-width: 0.6;
            transition: fill 0.2s;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .highlight-province {
            fill: var(--province-hover) !important;
            stroke: #fff !important;
        }

        /* تولتیپ هوشمند */
        #tooltip {
            position: fixed;
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: none;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        /* استایل لودر */
        #loader { font-size: 14px; opacity: 0.7; }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>فهرست استان‌ها</h2>
            </div>
            <ul class="province-list" id="province-list"></ul>
        </aside>

        <main id="map-container">
            <div id="loader">در حال بارگذاری نقشه...</div>
        </main>
    </div>

    <div id="tooltip"></div>

    <script>
        const provinceNames = {
            "Ardabil": "اردبیل", "Isfahan": "اصفهان", "Alborz": "البرز", "Ilam": "ایلام",
            "Bushehr": "بوشهر", "Tehran": "تهران", "Chaharmahal and Bakhtiari": "چهارمحال و بختیاری",
            "South Khorasan": "خراسان جنوبی", "Razavi Khorasan": "خراسان رضوی", "North Khorasan": "خراسان شمالی",
            "Khuzestan": "خوزستان", "Zanjan": "زنجان", "Semnan": "سمنان", "Sistan and Baluchestan": "سیستان و بلوچستان",
            "Fars": "فارس", "Qazvin": "قزوین", "Qom": "قم", "Kurdistan": "کردستان",
            "Kerman": "کرمان", "Kermanshah": "کرمانشاه", "Kohgiluyeh and Boyer-Ahmad": "کهگیلویه و بویراحمد",
            "Golestan": "گلستان", "Gilan": "گیلان", "Lorestan": "لرستان", "Mazandaran": "مازندران",
            "Markazi": "مرکزی", "Hormozgan": "هرمزگان", "Hamadan": "همدان", "Yazd": "یزد",
            "West Azerbaijan": "آذربایجان غربی", "East Azerbaijan": "آذربایجان شرقی"
        };

        const mapUrl = 'https://raw.githubusercontent.com/nastoohir/iran-map-svg/master/iran.svg';
        const container = document.getElementById('map-container');
        const listContainer = document.getElementById('province-list');
        const tooltip = document.getElementById('tooltip');

        async function init() {
            try {
                const response = await fetch(mapUrl);
                const svgText = await response.text();
                container.innerHTML = svgText;
                setupInteractions();
            } catch (e) {
                container.innerHTML = "خطا در بارگذاری نقشه";
            }
        }

        function setupInteractions() {
            const provinces = document.querySelectorAll('svg path');
            const isMobile = window.innerWidth <= 768;

            provinces.forEach(p => {
                const id = p.getAttribute('id');
                if (!id || id.includes("Sea") || id.includes("Gulf")) {
                    p.style.fill = "#080e1e";
                    p.style.pointerEvents = "none";
                    return;
                }

                const farsiName = provinceNames[id] || id;

                // ایجاد لیست
                const li = document.createElement('li');
                li.className = 'province-item';
                li.innerHTML = `<span>${farsiName}</span> <span>←</span>`;
                listContainer.appendChild(li);

                // رویدادهای نقشه
                const showSelection = (e) => {
                    provinces.forEach(pr => pr.classList.remove('highlight-province'));
                    p.classList.add('highlight-province');
                    
                    tooltip.style.display = 'block';
                    tooltip.innerText = farsiName;
                    
                    if (isMobile) {
                        // در موبایل تولتیپ را بالای نقشه ثابت نگه می‌داریم
                        tooltip.style.left = '50%';
                        tooltip.style.transform = 'translateX(-50%)';
                        tooltip.style.top = '20px';
                    } else {
                        tooltip.style.left = (e.clientX + 15) + 'px';
                        tooltip.style.top = (e.clientY - 30) + 'px';
                        tooltip.style.transform = 'none';
                    }
                    
                    document.querySelectorAll('.province-item').forEach(item => item.classList.remove('active'));
                    li.classList.add('active');
                    li.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                };

                p.addEventListener('mouseenter', showSelection);
                p.addEventListener('mousemove', showSelection);
                p.addEventListener('touchstart', (e) => {
                    showSelection(e);
                    // جلوگیری از کلیک ناخواسته بلافاصله بعد از لمس
                });

                p.addEventListener('click', () => {
                    setTimeout(() => {
                        window.location.href = `provinces/${id.replace(/\s+/g, '-')}.html`;
                    }, 100);
                });

                // رویدادهای لیست
                li.addEventListener('click', () => {
                    provinces.forEach(pr => pr.classList.remove('highlight-province'));
                    p.classList.add('highlight-province');
                    
                    if (isMobile) {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            });

            container.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        }

        window.onload = init;
    </script>
</body>
</html>